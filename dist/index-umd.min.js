!function(t,y){"object"==typeof exports&&"undefined"!=typeof module?y(exports):"function"==typeof define&&define.amd?define(["exports"],y):y((t=t||self).SvgIntersections={})}(this,function(t){"use strict";function e(t,y){return t(y={exports:{}},y.exports),y.exports}var n=e(function(t){function y(t,y){Object.defineProperties(this,{x:{value:t,writable:!1,enumerable:!0,configurable:!1},y:{value:y,writable:!1,enumerable:!0,configurable:!1}})}y.prototype.clone=function(){return new this.constructor(this.x,this.y)},y.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},y.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},y.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},y.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},y.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},y.prototype.lerp=function(t,y){var e=1-y;return new this.constructor(this.x*e+t.x*y,this.y*e+t.y*y)},y.prototype.distanceFrom=function(t){var y=this.x-t.x,e=this.y-t.y;return Math.sqrt(y*y+e*e)},y.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},y.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},y.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},y.prototype.toString=function(){return"point("+this.x+","+this.y+")"},t.exports=y}),x=e(function(t){function y(t,y){Object.defineProperties(this,{x:{value:t,writable:!1,enumerable:!0,configurable:!1},y:{value:y,writable:!1,enumerable:!0,configurable:!1}})}y.fromPoints=function(t,e){return new y(e.x-t.x,e.y-t.y)},y.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},y.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},y.prototype.dot=function(t){return this.x*t.x+this.y*t.y},y.prototype.cross=function(t){return this.x*t.y-this.y*t.x},y.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},y.prototype.unit=function(){return this.divide(this.length())},y.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},y.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},y.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},y.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},y.prototype.angleBetween=function(t){var y=this.dot(t)/(this.length()*t.length());y=Math.max(-1,Math.min(y,1));var e=Math.acos(y);return this.cross(t)<0?-e:e},y.prototype.perp=function(){return new this.constructor(-this.y,this.x)},y.prototype.perpendicular=function(t){return this.subtract(this.project(t))},y.prototype.project=function(t){var y=this.dot(t)/t.dot(t);return t.multiply(y)},y.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},y.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},y.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},t.exports=y}),r=e(function(t){function y(t,y,e,n,x,r){Object.defineProperties(this,{a:{value:void 0!==t?t:1,writable:!1,enumerable:!0,configurable:!1},b:{value:void 0!==y?y:0,writable:!1,enumerable:!0,configurable:!1},c:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1},d:{value:void 0!==n?n:1,writable:!1,enumerable:!0,configurable:!1},e:{value:void 0!==x?x:0,writable:!1,enumerable:!0,configurable:!1},f:{value:void 0!==r?r:0,writable:!1,enumerable:!0,configurable:!1}})}y.IDENTITY=new y(1,0,0,1,0,0),y.IDENTITY.isIdentity=function(){return!0},y.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},y.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw"Matrix is not invertible";var y=1/t,e=this.f*this.c-this.e*this.d,n=this.e*this.b-this.f*this.a;return new this.constructor(this.d*y,-this.b*y,-this.c*y,this.a*y,e*y,n*y)},y.prototype.translate=function(t,y){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*y+this.e,this.b*t+this.d*y+this.f)},y.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},y.prototype.scaleAt=function(t,y){var e=y.x-t*y.x,n=y.y-t*y.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*e+this.c*n+this.e,this.b*e+this.d*n+this.f)},y.prototype.scaleNonUniform=function(t,y){return new this.constructor(this.a*t,this.b*t,this.c*y,this.d*y,this.e,this.f)},y.prototype.scaleNonUniformAt=function(t,y,e){var n=e.x-t*e.x,x=e.y-y*e.y;return new this.constructor(this.a*t,this.b*t,this.c*y,this.d*y,this.a*n+this.c*x+this.e,this.b*n+this.d*x+this.f)},y.prototype.rotate=function(t){var y=Math.cos(t),e=Math.sin(t);return new this.constructor(this.a*y+this.c*e,this.b*y+this.d*e,this.a*-e+this.c*y,this.b*-e+this.d*y,this.e,this.f)},y.prototype.rotateAt=function(t,y){var e=Math.cos(t),n=Math.sin(t),x=-y.x+y.x*e-y.y*n,r=-y.y+y.y*e+y.x*n;return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.a*x+this.c*r+this.e,this.b*x+this.d*r+this.f)},y.prototype.rotateFromVector=function(t){var y=t.unit(),e=y.x,n=y.y;return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)},y.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},y.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},y.prototype.skewX=function(t){var y=Math.tan(t);return new this.constructor(this.a,this.b,this.a*y+this.c,this.b*y+this.d,this.e,this.f)},y.prototype.skewY=function(t){var y=Math.tan(t);return new this.constructor(this.a+this.c*y,this.b+this.d*y,this.c,this.d,this.e,this.f)},y.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},y.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},y.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},y.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),y=.5*(this.a-this.d),e=.5*(this.b+this.c),n=.5*(this.b-this.c),x=Math.sqrt(t*t+n*n),r=Math.sqrt(y*y+e*e),i=x+r,s=x-r,o=Math.atan2(e,y),a=Math.atan2(n,t),h=.5*(a-o),p=.5*(a+o);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(p),scale:new this.constructor(i,0,0,s,0,0),rotation0:this.constructor.IDENTITY.rotate(h)}},y.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},y.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},t.exports=y}),s=n,o=x,a=r;function h(t,y){this.init(t,y)}h.prototype.init=function(t,y){this.type=t,this.params=y,this.meta={}},h.TYPE={};var p=h.TYPE;function u(t){return t.split(" ").map(function(t){return t=t.split(","),new s(t[0],t[1])})}p.LINE="Line",p.RECT="Rectangle",p.ROUNDRECT="RoundRectangle",p.CIRCLE="Circle",p.ELLIPSE="Ellipse",p.POLYGON="Polygon",p.POLYLINE="Polyline",p.PATH="Path",p.ARC="Arc",p.BEZIER2="Bezier2",p.BEZIER3="Bezier3",h.newShape=function(t,y){return"line"===(t=t.toLowerCase())?h.newLine(new s(y.x1,y.y1),new s(y.x2,y.y2)):"rect"===t?y.rx>0||y.ry>0?h.newRoundRect(y.x,y.y,y.width,y.height,y.rx,y.ry):h.newRect(y.x,y.y,y.width,y.height):"circle"===t?h.newCircle(new s(y.cx,y.cy),y.r):"ellipse"===t?h.newEllipse(new s(y.cx,y.cy),y.rx,y.ry):"polygon"===t?h.newPolygon(u(y.points)):"polyline"===t?h.newPolyline(u(y.points)):"path"===t?h.newPath(y.d):void 0},h.newArc=function(t,y,e,n,x,r,i){var o=function(t,y,e,n,x,r,i){function o(t,y,e,n){var x=t*e+y*n,r=Math.sqrt((t*t+y*y)*(e*e+n*n)),i=Math.acos(x/r);return t*n-y*e<0&&(i=-i),i}x=x*Math.PI/180;var a,h=Math.cos(x),p=Math.sin(x),u=t.subtract(y).divide(2),c=u.x*h+u.y*p,l=u.x*-p+u.y*h,f=c*c,w=l*l,d=f/(e*e)+w/(n*n);d>1&&(e*=a=Math.sqrt(d),n*=a);var m=e*e,v=n*n,g=m*w,b=v*f;a=(m*v-g-b)/(g+b),Math.abs(a)<1e-6&&(a=0);var P=Math.sqrt(a);r==i&&(P=-P);for(var M=t.add(y).divide(2),E=P*e*l/n,L=P*-n*c/e,R=(c-E)/e,I=(c+E)/e,N=(l-L)/n,C=(l+L)/n,A=o(1,0,R,N),T=o(R,N,-I,-C),S=2*Math.PI;T>S;)T-=S;for(;T<0;)T+=S;return 0==i&&(T-=S),{center:new s(E*h-L*p+M.x,E*p+L*h+M.y),rx:e,ry:n,theta1:A,deltaTheta:T}}(t,y,e,n,x,r,i);return new h(p.ARC,[o.center,o.rx,o.ry,x*Math.PI/180,o.theta1,o.deltaTheta])},h.newBezier2=function(t,y,e){return new h(p.BEZIER2,[t,y,e])},h.newBezier3=function(t,y,e,n){return new h(p.BEZIER3,[t,y,e,n])},h.newCircle=function(t,y){return new h(p.CIRCLE,[t,y])},h.newEllipse=function(t,y,e){return new h(p.ELLIPSE,[t,y,e])},h.newLine=function(t,y){return new h(p.LINE,[t,y])},h.newPolygon=function(t){return new h(p.POLYGON,[t])},h.newPolyline=function(t){return new h(p.POLYLINE,[t])},h.newRect=function(t,y,e,n){var x=[];return x.push(new s(t,y)),x.push(new s(t+e,y)),x.push(new s(t+e,y+n)),x.push(new s(t,y+n)),new h(p.RECT,[x])};var c=function(t){return t*Math.PI/180};function l(t,y){arguments.length>0&&this.init(t,y)}h.newRoundRect=function(t,y,e,n,x,r){if(0===x&&0===r)return h.newRect(t,y,e,n);0===x&&(x=r),0===r&&(r=x),x>e/2&&(x=e/2),r>n/2&&(x=n/2);var i=[],o=t,a=t+x,u=t+e-x,l=t+e,f=y,w=y+r,d=y+n-r,m=y+n;return i.push(new h(p.ARC,[new s(a,w),x,r,0,c(180),c(90)])),i.push(new h(p.LINE,[new s(a,f),new s(u,f)])),i.push(new h(p.ARC,[new s(u,w),x,r,0,c(-90),c(90)])),i.push(new h(p.LINE,[new s(l,w),new s(l,d)])),i.push(new h(p.ARC,[new s(u,d),x,r,0,c(0),c(90)])),i.push(new h(p.LINE,[new s(u,m),new s(a,m)])),i.push(new h(p.ARC,[new s(a,d),x,r,0,c(90),c(90)])),i.push(new h(p.LINE,[new s(o,d),new s(o,w)])),i[i.length-1].meta.closePath=!0,new h(p.ROUNDRECT,[i])},l.prototype.init=function(t,y){this.type=t,this.text=y},l.prototype.typeis=function(t){return this.type==t};var f={};function w(t,y,e){arguments.length>0&&this.init(t,y,e)}function d(t,y){arguments.length>0&&this.init("A",t,y)}function m(t,y){arguments.length>0&&this.init("Q",t,y)}function v(t,y){arguments.length>0&&this.init("C",t,y)}function g(t,y){arguments.length>0&&this.init("H",t,y)}function b(t,y){arguments.length>0&&this.init("V",t,y)}function P(t,y){arguments.length>0&&this.init("L",t,y)}function M(t,y){arguments.length>0&&this.init("M",t,y)}function E(t,y){arguments.length>0&&this.init("T",t,y)}function L(t,y){arguments.length>0&&this.init("S",t,y)}function R(t,y,e){arguments.length>0&&this.init(t,y,e)}function I(t,y){arguments.length>0&&this.init("z",t,y)}function N(t,y){arguments.length>0&&this.init("q",t,y)}function C(t,y){arguments.length>0&&this.init("c",t,y)}function A(t,y){arguments.length>0&&this.init("l",t,y)}function T(t,y){arguments.length>0&&this.init("m",t,y)}function S(t,y){arguments.length>0&&this.init("t",t,y)}function D(t,y){arguments.length>0&&this.init("s",t,y)}f.COMMAND=0,f.NUMBER=1,f.EOD=2,f.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]},h.newPath=function(t){for(var y=function(t){for(var y=new Array;""!=t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))y[y.length]=new l(f.COMMAND,RegExp.$1),t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("Unrecognized segment command: "+t);y[y.length]=new l(f.NUMBER,parseFloat(RegExp.$1)),t=t.substr(RegExp.$1.length)}return y[y.length]=new l(f.EOD,null),y}(t),e=0,n=y[e],x="BOD",r=[];!n.typeis(f.EOD);){var i,s=new Array;if("BOD"==x){if("M"!=n.text&&"m"!=n.text)throw new Error("Path data must begin with a moveto command");e++,i=f.PARAMS[n.text].length,x=n.text}else n.typeis(f.NUMBER)?i=f.PARAMS[x].length:(e++,i=f.PARAMS[n.text].length,x=n.text);if(!(e+i<y.length))throw new Error("Path data ended before all parameters were found");for(var o=e;o<e+i;o++){var a=y[o];if(!a.typeis(f.NUMBER))throw new Error("Parameter type is not a number: "+x+","+a.text);s[s.length]=a.text}var u,c=r.length,w=0==c?null:r[c-1];switch(x){case"A":u=new d(s,w);break;case"C":u=new v(s,w);break;case"c":u=new C(s,w);break;case"H":u=new g(s,w);break;case"V":u=new b(s,w);break;case"L":u=new P(s,w);break;case"l":u=new A(s,w);break;case"M":u=new M(s,w);break;case"m":u=new T(s,w);break;case"Q":u=new m(s,w);break;case"q":u=new N(s,w);break;case"S":u=new L(s,w);break;case"s":u=new D(s,w);break;case"T":u=new E(s,w);break;case"t":u=new S(s,w);break;case"Z":case"z":u=new I(s,w);break;default:throw new Error("Unsupported segment type: "+x)}r.push(u),n=y[e+=i],"M"==x&&(x="L"),"m"==x&&(x="l")}var R=[];for(o=0;o<r.length;o++){var B=r[o].getIntersectionParams();B&&R.push(B)}return new h(p.PATH,[R])},w.prototype.init=function(t,y,e){this.command=t,this.previous=e,this.points=[];for(var n=0;n<y.length;)this.points.push(new s(y[n],y[n+1])),n+=2},w.prototype.getLastPoint=function(){return this.points[this.points.length-1]},w.prototype.getIntersectionParams=function(){return null},d.prototype=new w,d.prototype.constructor=m,d.superclass=w.prototype,d.prototype.init=function(t,y,e){var n=new Array,x=y.pop(),r=y.pop();n.push(r,x),d.superclass.init.call(this,t,n,e),this.rx=parseFloat(y.shift()),this.ry=parseFloat(y.shift()),this.angle=parseFloat(y.shift()),this.arcFlag=parseFloat(y.shift()),this.sweepFlag=parseFloat(y.shift())},d.prototype.getIntersectionParams=function(){return h.newArc(this.previous.getLastPoint(),this.points[0],this.rx,this.ry,this.angle,this.arcFlag,this.sweepFlag)},m.prototype=new w,m.prototype.constructor=m,m.superclass=w.prototype,m.prototype.getIntersectionParams=function(){return h.newBezier2(this.previous.getLastPoint(),this.points[0],this.points[1])},v.prototype=new w,v.prototype.constructor=v,v.superclass=w.prototype,v.prototype.getLastControlPoint=function(){return this.points[1]},v.prototype.getIntersectionParams=function(){return h.newBezier3(this.previous.getLastPoint(),this.points[0],this.points[1],this.points[2])},g.prototype=new w,g.prototype.constructor=g,g.superclass=w.prototype,g.prototype.init=function(t,y,e){var n=e.getLastPoint(),x=new Array;x.push(y.pop(),n.y),g.superclass.init.call(this,t,x,e)},b.prototype=new w,b.prototype.constructor=b,b.superclass=w.prototype,b.prototype.init=function(t,y,e){var n=e.getLastPoint(),x=new Array;x.push(n.x,y.pop()),b.superclass.init.call(this,t,x,e)},P.prototype=new w,P.prototype.constructor=P,P.superclass=w.prototype,P.prototype.getIntersectionParams=function(){return h.newLine(this.previous.getLastPoint(),this.points[0])},M.prototype=new w,M.prototype.constructor=M,M.superclass=w.prototype,E.prototype=new w,E.prototype.constructor=E,E.superclass=w.prototype,E.prototype.getControlPoint=function(){var t,y=this.previous.getLastPoint();if(this.previous.command.match(/^[QqTt]$/)){var e=this.previous.getControlPoint().subtract(y);t=y.subtract(e)}else t=y;return t},E.prototype.getIntersectionParams=function(){return h.newBezier2(this.previous.getLastPoint(),this.getControlPoint(),this.points[0])},L.prototype=new w,L.prototype.constructor=L,L.superclass=w.prototype,L.prototype.getFirstControlPoint=function(){var t,y=this.previous.getLastPoint();if(this.previous.command.match(/^[SsCc]$/)){var e=this.previous.getLastControlPoint().subtract(y);t=y.subtract(e)}else t=y;return t},L.prototype.getLastControlPoint=function(){return this.points[0]},L.prototype.getIntersectionParams=function(){return h.newBezier3(this.previous.getLastPoint(),this.getFirstControlPoint(),this.points[0],this.points[1])},R.prototype=new w,R.prototype.constructor=R,R.superclass=w.prototype,R.prototype.init=function(t,y,e){var n;this.command=t,this.previous=e,this.points=[],n=this.previous?this.previous.getLastPoint():new s(0,0);for(var x=0;x<y.length;){var r=new s(n.x+y[x],n.y+y[x+1]);this.points.push(r),x+=2}},I.prototype=new R,I.prototype.constructor=I,I.superclass=R.prototype,I.prototype.getLastPoint=function(){for(var t,y=this.previous;y;){if(y.command.match(/^[mMzZ]$/)){t=y.getLastPoint();break}y=y.previous}return t},I.prototype.getIntersectionParams=function(){return h.newLine(this.previous.getLastPoint(),this.getLastPoint())},N.prototype=new R,N.prototype.constructor=N,N.superclass=R.prototype,N.prototype.getControlPoint=function(){return this.points[0]},N.prototype.getIntersectionParams=function(){return h.newBezier2(this.previous.getLastPoint(),this.points[0],this.points[1])},C.prototype=new R,C.prototype.constructor=C,C.superclass=R.prototype,C.prototype.getLastControlPoint=function(){return this.points[1]},C.prototype.getIntersectionParams=function(){return h.newBezier3(this.previous.getLastPoint(),this.points[0],this.points[1],this.points[2])},A.prototype=new R,A.prototype.constructor=A,A.superclass=R.prototype,A.prototype.toString=function(){var t,y,e;return t=this.previous?this.previous.getLastPoint():new s(0,0),y=this.points[0].subtract(t),this.previous.constructor!=this.constuctor&&this.previous.constructor!=T&&(e=this.command),e+y.toString()},A.prototype.getIntersectionParams=function(){return h.newLine(this.previous.getLastPoint(),this.points[0])},T.prototype=new R,T.prototype.constructor=T,T.superclass=R.prototype,S.prototype=new R,S.prototype.constructor=S,S.superclass=R.prototype,S.prototype.getControlPoint=function(){var t,y=this.previous.getLastPoint();if(this.previous.command.match(/^[QqTt]$/)){var e=this.previous.getControlPoint().subtract(y);t=y.subtract(e)}else t=y;return t},S.prototype.getIntersectionParams=function(){return h.newBezier2(this.previous.getLastPoint(),this.getControlPoint(),this.points[0])},D.prototype=new R,D.prototype.constructor=D,D.superclass=R.prototype,D.prototype.getFirstControlPoint=function(){var t,y=this.previous.getLastPoint();if(this.previous.command.match(/^[SsCc]$/)){var e=this.previous.getLastControlPoint().subtract(y);t=y.subtract(e)}else t=y;return t},D.prototype.getLastControlPoint=function(){return this.points[0]},D.prototype.getIntersectionParams=function(){return h.newBezier3(this.previous.getLastPoint(),this.getFirstControlPoint(),this.points[0],this.points[1])};var B=e(function(t){function e(){this.init(arguments)}e.TOLERANCE=1e-6,e.ACCURACY=15,e.interpolate=function(t,y,e,n,x){if(t.constructor!==Array||y.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(e)||isNaN(n)||isNaN(x))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var r=0,i=0,s=new Array(e),o=new Array(e),a=0,h=Math.abs(x-t[n]),p=0;p<e;p++){var u=Math.abs(x-t[n+p]);u<h&&(a=p,h=u),s[p]=o[p]=y[n+p]}r=y[n+a],a--;for(var c=1;c<e;c++){for(p=0;p<e-c;p++){var l=t[n+p]-x,f=t[n+p+c]-x,w=s[p+1]-o[p],d=l-f;if(0==d)break;d=w/d,o[p]=f*d,s[p]=l*d}r+=i=2*(a+1)<e-c?s[a+1]:o[a--]}return{y:r,dy:i}},e.prototype.init=function(t){this.coefs=new Array;for(var y=t.length-1;y>=0;y--)this.coefs.push(t[y]);this._variable="t",this._s=0},e.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var y=0,e=this.coefs.length-1;e>=0;e--)y=y*t+this.coefs[e];return y},e.prototype.add=function(t){for(var y=new e,n=this.getDegree(),x=t.getDegree(),r=Math.max(n,x),i=0;i<=r;i++){var s=i<=n?this.coefs[i]:0,o=i<=x?t.coefs[i]:0;y.coefs[i]=s+o}return y},e.prototype.multiply=function(t){for(var y=new e,n=0;n<=this.getDegree()+t.getDegree();n++)y.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var x=0;x<=t.getDegree();x++)y.coefs[n+x]+=this.coefs[n]*t.coefs[x];return y},e.prototype.divide_scalar=function(t){for(var y=0;y<this.coefs.length;y++)this.coefs[y]/=t},e.prototype.simplify=function(){for(var t=this.getDegree();t>=0&&Math.abs(this.coefs[t])<=1e-15;t--)this.coefs.pop()},e.prototype.bisection=function(t,y){var n,x=this.eval(t),r=this.eval(y);if(Math.abs(x)<=e.TOLERANCE)n=t;else if(Math.abs(r)<=e.TOLERANCE)n=y;else if(x*r<=0)for(var i=Math.log(y-t),s=Math.LN10*e.ACCURACY,o=Math.ceil((i+s)/Math.LN2),a=0;a<o;a++){n=.5*(t+y);var h=this.eval(n);if(Math.abs(h)<=e.TOLERANCE)break;h*x<0?(y=n,r=h):(t=n,x=h)}return n},e.prototype.toString=function(){for(var t=new Array,y=new Array,e=this.coefs.length-1;e>=0;e--){var n=Math.round(1e3*this.coefs[e])/1e3;if(0!=n){var x=n<0?" - ":" + ";n=Math.abs(n),e>0&&(1==n?n=this._variable:n+=this._variable),e>1&&(n+="^"+e),y.push(x),t.push(n)}}y[0]=" + "==y[0]?"":"-";var r="";for(e=0;e<t.length;e++)r+=y[e]+t[e];return r},e.prototype.trapezoid=function(t,y,e){if(isNaN(t)||isNaN(y)||isNaN(e))throw new Error("Polynomial.trapezoid: parameters must be numbers");var n=y-t;if(1==e){var x=this.eval(t),r=this.eval(y);this._s=.5*n*(x+r)}else{for(var i=1<<e-2,s=n/i,o=t+.5*s,a=0,h=0;h<i;h++)a+=this.eval(o),o+=s;this._s=.5*(this._s+n*a/i)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},e.prototype.simpson=function(t,y){if(isNaN(t)||isNaN(y))throw new Error("Polynomial.simpson: parameters must be numbers");for(var e=y-t,n=.5*e*(this.eval(t)+this.eval(y)),x=n,r=4*n/3,i=r,s=n,o=1,a=2;a<=20;a++){for(var h=e/o,p=t+.5*h,u=0,c=1;c<=o;c++)u+=this.eval(p),p+=h;if(r=(4*(n=x=.5*(x+e*u/o))-s)/3,Math.abs(r-i)<1e-7*Math.abs(i))break;i=r,s=n,o<<=1}return r},e.prototype.romberg=function(t,y){if(isNaN(t)||isNaN(y))throw new Error("Polynomial.romberg: parameters must be numbers");var n=new Array(21),x=new Array(21),r={y:0,dy:0};x[0]=1;for(var i=1;i<=20&&(n[i-1]=this.trapezoid(t,y,i),!(i>=3&&(r=e.interpolate(x,n,3,i-3,0),Math.abs(r.dy)<=1e-6*r.y)));i++)n[i]=n[i-1],x[i]=.25*x[i-1];return r.y},e.prototype.getDegree=function(){return this.coefs.length-1},e.prototype.getDerivative=function(){for(var t=new e,y=1;y<this.coefs.length;y++)t.coefs.push(y*this.coefs[y]);return t},e.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=new Array;break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=new Array}return t},e.prototype.getRootsInInterval=function(t,y){var e,n=new Array;if(1==this.getDegree())null!=(e=this.bisection(t,y))&&n.push(e);else{var x=this.getDerivative().getRootsInInterval(t,y);if(x.length>0){for(null!=(e=this.bisection(t,x[0]))&&n.push(e),i=0;i<=x.length-2;i++)null!=(e=this.bisection(x[i],x[i+1]))&&n.push(e);null!=(e=this.bisection(x[x.length-1],y))&&n.push(e)}else null!=(e=this.bisection(t,y))&&n.push(e)}return n},e.prototype.getLinearRoot=function(){var t=new Array,y=this.coefs[1];return 0!=y&&t.push(-this.coefs[0]/y),t},e.prototype.getQuadraticRoots=function(){var t=new Array;if(2==this.getDegree()){var y=this.coefs[2],e=this.coefs[1]/y,n=e*e-4*(this.coefs[0]/y);if(n>0){var x=Math.sqrt(n);t.push(.5*(-e+x)),t.push(.5*(-e-x))}else 0==n&&t.push(.5*-e)}return t},e.prototype.getCubicRoots=function(){var t=new Array;if(3==this.getDegree()){var y=this.coefs[3],e=this.coefs[2]/y,n=this.coefs[1]/y,x=(3*n-e*e)/3,r=(2*e*e*e-9*n*e+27*(this.coefs[0]/y))/27,i=e/3,s=r*r/4+x*x*x/27,o=r/2,a=this.zeroErrorEstimate();if(Math.abs(s)<=a&&(s=0),s>0){var h,p=Math.sqrt(s);h=(d=-o+p)>=0?Math.pow(d,1/3):-Math.pow(-d,1/3),(d=-o-p)>=0?h+=Math.pow(d,1/3):h-=Math.pow(-d,1/3),t.push(h-i)}else if(s<0){var u=Math.sqrt(-x/3),c=Math.atan2(Math.sqrt(-s),-o)/3,l=Math.cos(c),f=Math.sin(c),w=Math.sqrt(3);t.push(2*u*l-i),t.push(-u*(l+w*f)-i),t.push(-u*(l-w*f)-i)}else{var d;d=o>=0?-Math.pow(o,1/3):Math.pow(-o,1/3),t.push(2*d-i),t.push(-d-i)}}return t};var n=function(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN};e.prototype.getQuarticRoots=function(){var t=[],y=this.getDegree();if(4==y){var x=new e;x.coefs=this.coefs.slice(),x.divide_scalar(x.coefs[y]);Math.abs(x.coefs[0])<10*1e-15*Math.abs(x.coefs[3])&&(x.coefs[0]=0);var r,i=x.getDerivative(),s=i.getRoots().sort(function(t,y){return t-y}),o=[],a=s.length-1,h=this.bounds();maxabsX=Math.max(Math.abs(h.minX),Math.abs(h.maxX));var p=this.zeroErrorEstimate(maxabsX);for(r=0;r<=a;r++)o.push(x.eval(s[r]));for(r=0;r<=a;r++)Math.abs(o[r])<p&&(o[r]=0);r=0;var u=Math.max(.1*(h.maxX-h.minX)/y,1e-15),c=[],l=[];if(a>-1){for(0!=o[0]?n(o[0])!=n(x.eval(s[0]-u)-o[0])&&(c.push(s[0]-u),l.push([h.minX,s[0]])):(t.push(s[0],s[0]),r++);r<a;r++)0==o[r+1]?(t.push(s[r+1],s[r+1]),r++):n(o[r])!=n(o[r+1])&&(c.push((s[r]+s[r+1])/2),l.push([s[r],s[r+1]]));0!=o[a]&&n(o[a])!=n(x.eval(s[a]+u)-o[a])&&(c.push(s[a]+u),l.push([s[a],h.maxX]))}var f=function(t){return x.eval(t)},w=function(t){return i.eval(t)};if(c.length>0)for(r=0;r<c.length;r++)c[r]=e.newton_secant_bisection(c[r],f,w,32,l[r][0],l[r][1]);t=t.concat(c)}return t},e.prototype.zeroErrorEstimate=function(t){if(void 0===t){var y=this.bounds();t=Math.max(Math.abs(y.minX),Math.abs(y.maxX))}if(t<.001)return 2*Math.abs(this.eval(1e-15));var e=this.coefs.length-1,n=this.coefs[e];return 10*1e-15*this.coefs.reduce(function(y,e,x){var r=e/n*Math.pow(t,x);return r>y?r:y},0)},e.prototype.bounds_UpperReal_Fujiwara=function(){var t=this.coefs,y=t.length-1,e=t[y];1!=e&&(t=this.coefs.map(function(t){return t/e}));var n,x=t.map(function(t,e){return e<y?Math.pow(Math.abs(0==e?t/2:t),1/(y-e)):t}),r=function(t,y,e){return n(e)&&(t.max<y?(t.nearmax=t.max,t.max=y):t.nearmax<y&&(t.nearmax=y)),t};n=function(e){return e<y&&t[e]<0};var i=x.reduce(r,{max:0,nearmax:0});return n=function(e){return e<y&&(y%2==e%2?t[e]<0:t[e]>0)},{negX:-2*x.reduce(r,{max:0,nearmax:0}).max,posX:2*i.max}},e.prototype.bounds_LowerReal_Fujiwara=function(){var t=new e;t.coefs=this.coefs.slice().reverse();var y=t.bounds_UpperReal_Fujiwara();return y.negX=1/y.negX,y.posX=1/y.posX,y},e.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),y={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX?y:(0===t.negX?y.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(y.maxX=this.bounds_LowerReal_Fujiwara().negX),y.minX>y.maxX&&(y.minX=y.maxX=0),y)},e.newton_secant_bisection=function(t,e,x,r,i,s){var o,a,h,p,u,c,l=0,f=0;o=t;var w=Math.pow(10,-14),d="number"==typeof i&&"number"==typeof s;if(d){if(i>s)throw new Error("newton root finding: min must be greater than max");if(u=e(i),c=e(s),n(u)==n(c))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var m,v=function(){return Math.abs(h)<=w*Math.abs(o)||f==o-h-o};for(m=0;m<r;m++){if(0==(a=x(o))){if(0==l)throw new Error("newton root finding: df(x) is zero");a=l}if(l=a,y=e(o),h=y/a,p=o-h,v())break;if(d){if(n(y)==n(c))s=o,c=y;else{if(n(y)!=n(u)){o=p;break}i=o,u=y}if(p<i||p>s){if(n(u)==n(c))break;var g=c-u,b=s-i;if(h=0==g?o-(i+.5*b):Math.abs(g/Math.min(u,c))>50?o-(i+b*(.5+(Math.abs(u)<Math.abs(c)?-.25:.25))):o-(i-u/g*b),p=o-h,v())break}}f=o-p,o=p}return o},t.exports=e}),k=(e(function(t){var y=B;function e(){this.init(arguments)}e.VERSION=1,e.prototype=new y,e.prototype.constructor=e,e.superclass=y.prototype,e.prototype.eval=function(t){var y=e.superclass.eval.call(this,t);if(Math.abs(y)<1e-7&&(y=0),y<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(y)},e.prototype.toString=function(){return"sqrt("+e.superclass.toString.call(this)+")"},t.exports=e}),B);function z(t){this.init(t)}function O(t){t.sort(function(t,y){return t-y});for(var y=1;y<t.length;)Math.abs(t[y]-t[y-1])<1e-15?t.splice(y,1):y++}z.prototype.init=function(t){this.status=t,this.points=[]},z.prototype.appendPoint=function(t){this.points.push(t)},z.prototype.appendPoints=function(t){this.points=this.points.concat(t)};var X={intersectBezier2Bezier2:function(t,y,e,n,x,r){var i,o,a,h,p,u,c,l,f,w,d,m,v,g,b,P,M=new z;i=y.multiply(-2),a=t.add(i.add(e)),i=t.multiply(-2),o=y.multiply(2),h=i.add(o),p=new s(t.x,t.y),i=x.multiply(-2),u=n.add(i.add(r)),i=n.multiply(-2),o=x.multiply(2),c=i.add(o),l=new s(n.x,n.y),0===a.y?(m=(w=a.x*(p.y-l.y))+(d=w-h.x*h.y),v=h.y*h.y,f=new k(a.x*u.y*u.y,2*a.x*c.y*u.y,a.x*c.y*c.y-u.x*v-u.y*w-u.y*d,-c.x*v-c.y*w-c.y*d,(p.x-l.x)*v+(p.y-l.y)*d)):(w=a.x*u.y-a.y*u.x,d=a.x*c.y-c.x*a.y,m=h.x*a.y-h.y*a.x,v=p.y-l.y,g=a.y*(p.x-l.x)-a.x*v,b=-h.y*m+a.y*g,P=m*m,f=new k(w*w,2*w*d,(-u.y*P+a.y*d*d+a.y*w*g+w*b)/a.y,(-c.y*P+a.y*d*g+d*b)/a.y,(v*P+g*b)/a.y));for(var E=f.getRoots(),L=0;L<E.length;L++){var R=E[L];if(0<=R&&R<=1){var I=new k(a.x,h.x,p.x-l.x-R*c.x-R*R*u.x).getRoots(),N=new k(a.y,h.y,p.y-l.y-R*c.y-R*R*u.y).getRoots();if(I.length>0&&N.length>0)t:for(var C=0;C<I.length;C++){var A=I[C];if(0<=A&&A<=1)for(var T=0;T<N.length;T++)if(Math.abs(A-N[T])<1e-4){M.points.push(u.multiply(R*R).add(c.multiply(R).add(l)));break t}}}}return M},intersectBezier2Bezier3:function(t,y,e,n,x,r,i){var a,h,p,u,c,l,f,w,d,m,v,g=new z;a=y.multiply(-2),c=t.add(a.add(e)),a=t.multiply(-2),h=y.multiply(2),l=a.add(h),f=new s(t.x,t.y),a=n.multiply(-1),h=x.multiply(3),p=r.multiply(-3),u=a.add(h.add(p.add(i))),w=new o(u.x,u.y),a=n.multiply(3),h=x.multiply(-6),p=r.multiply(3),u=a.add(h.add(p)),d=new o(u.x,u.y),a=n.multiply(-3),h=x.multiply(3),p=a.add(h),m=new o(p.x,p.y),v=new o(n.x,n.y);var b=f.x*f.x,P=f.y*f.y,M=l.x*l.x,E=l.y*l.y,L=c.x*c.x,R=c.y*c.y,I=v.x*v.x,N=v.y*v.y,C=m.x*m.x,A=m.y*m.y,T=d.x*d.x,S=d.y*d.y,D=w.x*w.x,B=w.y*w.y,X=new k(-2*c.x*c.y*w.x*w.y+L*B+R*D,-2*c.x*c.y*d.x*w.y-2*c.x*c.y*d.y*w.x+2*R*d.x*w.x+2*L*d.y*w.y,-2*c.x*m.x*c.y*w.y-2*c.x*c.y*m.y*w.x-2*c.x*c.y*d.x*d.y+2*m.x*R*w.x+R*T+L*(2*m.y*w.y+S),2*f.x*c.x*c.y*w.y+2*f.y*c.x*c.y*w.x+l.x*l.y*c.x*w.y+l.x*l.y*c.y*w.x-2*v.x*c.x*c.y*w.y-2*c.x*v.y*c.y*w.x-2*c.x*m.x*c.y*d.y-2*c.x*c.y*m.y*d.x-2*f.x*R*w.x-2*f.y*L*w.y+2*v.x*R*w.x+2*m.x*R*d.x-E*c.x*w.x-M*c.y*w.y+L*(2*v.y*w.y+2*m.y*d.y),2*f.x*c.x*c.y*d.y+2*f.y*c.x*c.y*d.x+l.x*l.y*c.x*d.y+l.x*l.y*c.y*d.x-2*v.x*c.x*c.y*d.y-2*c.x*v.y*c.y*d.x-2*c.x*m.x*c.y*m.y-2*f.x*R*d.x-2*f.y*L*d.y+2*v.x*R*d.x-E*c.x*d.x-M*c.y*d.y+C*R+L*(2*v.y*d.y+A),2*f.x*c.x*c.y*m.y+2*f.y*c.x*m.x*c.y+l.x*l.y*c.x*m.y+l.x*l.y*m.x*c.y-2*v.x*c.x*c.y*m.y-2*c.x*v.y*m.x*c.y-2*f.x*m.x*R-2*f.y*L*m.y+2*v.x*m.x*R-E*c.x*m.x-M*c.y*m.y+2*L*v.y*m.y,-2*f.x*f.y*c.x*c.y-f.x*l.x*l.y*c.y-f.y*l.x*l.y*c.x+2*f.x*c.x*v.y*c.y+2*f.y*v.x*c.x*c.y+l.x*v.x*l.y*c.y+l.x*l.y*c.x*v.y-2*v.x*c.x*v.y*c.y-2*f.x*v.x*R+f.x*E*c.x+f.y*M*c.y-2*f.y*L*v.y-v.x*E*c.x-M*v.y*c.y+b*R+P*L+I*R+L*N).getRootsInInterval(0,1);O(X);for(var _=0;_<X.length;_++){var F=X[_],q=new k(c.x,l.x,f.x-v.x-F*m.x-F*F*d.x-F*F*F*w.x).getRoots(),Y=new k(c.y,l.y,f.y-v.y-F*m.y-F*F*d.y-F*F*F*w.y).getRoots();if(q.length>0&&Y.length>0)t:for(var U=0;U<q.length;U++){var j=q[U];if(0<=j&&j<=1)for(var Q=0;Q<Y.length;Q++)if(Math.abs(j-Y[Q])<1e-4){var Z=w.multiply(F*F*F).add(d.multiply(F*F).add(m.multiply(F).add(v)));g.points.push(new s(Z.x,Z.y));break t}}}return g},intersectBezier2Ellipse:function(t,y,e,n,x,r){var i,o,a,h,p,u=new z;i=y.multiply(-2),a=t.add(i.add(e)),i=t.multiply(-2),o=y.multiply(2),h=i.add(o),p=new s(t.x,t.y);for(var c=x*x,l=r*r,f=new k(l*a.x*a.x+c*a.y*a.y,2*(l*a.x*h.x+c*a.y*h.y),l*(2*a.x*p.x+h.x*h.x)+c*(2*a.y*p.y+h.y*h.y)-2*(l*n.x*a.x+c*n.y*a.y),2*(l*h.x*(p.x-n.x)+c*h.y*(p.y-n.y)),l*(p.x*p.x+n.x*n.x)+c*(p.y*p.y+n.y*n.y)-2*(l*n.x*p.x+c*n.y*p.y)-c*l).getRoots(),w=0;w<f.length;w++){var d=f[w];0<=d&&d<=1&&u.points.push(a.multiply(d*d).add(h.multiply(d).add(p)))}return u},intersectBezier2Line:function(t,y,e,n,x){var r,i,a,h,p,u,c,l=n.min(x),f=n.max(x),w=new z;r=y.multiply(-2),a=t.add(r.add(e)),r=t.multiply(-2),i=y.multiply(2),h=r.add(i),p=new s(t.x,t.y),c=new o(n.y-x.y,x.x-n.x),u=n.x*x.y-x.x*n.y;for(var d=new k(c.dot(a),c.dot(h),c.dot(p)+u).getRoots(),m=0;m<d.length;m++){var v=d[m];if(0<=v&&v<=1){var g=t.lerp(y,v),b=y.lerp(e,v),P=g.lerp(b,v);n.x==x.x?l.y<=P.y&&P.y<=f.y&&w.appendPoint(P):n.y==x.y?l.x<=P.x&&P.x<=f.x&&w.appendPoint(P):l.x<=P.x&&P.x<=f.x&&l.y<=P.y&&P.y<=f.y&&w.appendPoint(P)}}return w},intersectBezier3Bezier3:function(t,y,e,n,x,r,i,a){var h,p,u,c,l,f,w,d,m,v,g,b,P=new z;h=t.multiply(-1),p=y.multiply(3),u=e.multiply(-3),c=h.add(p.add(u.add(n))),l=new o(c.x,c.y),h=t.multiply(3),p=y.multiply(-6),u=e.multiply(3),c=h.add(p.add(u)),f=new o(c.x,c.y),h=t.multiply(-3),p=y.multiply(3),u=h.add(p),w=new o(u.x,u.y),d=new o(t.x,t.y),h=x.multiply(-1),p=r.multiply(3),u=i.multiply(-3),c=h.add(p.add(u.add(a))),m=new o(c.x,c.y),h=x.multiply(3),p=r.multiply(-6),u=i.multiply(3),c=h.add(p.add(u)),v=new o(c.x,c.y),h=x.multiply(-3),p=r.multiply(3),u=h.add(p),g=new o(u.x,u.y),b=new o(x.x,x.y);var M=d.x*d.x,E=d.x*d.x*d.x,L=d.y*d.y,R=d.y*d.y*d.y,I=w.x*w.x,N=w.x*w.x*w.x,C=w.y*w.y,A=w.y*w.y*w.y,T=f.x*f.x,S=f.x*f.x*f.x,D=f.y*f.y,B=f.y*f.y*f.y,X=l.x*l.x,_=l.x*l.x*l.x,F=l.y*l.y,q=l.y*l.y*l.y,Y=b.x*b.x,U=b.x*b.x*b.x,j=b.y*b.y,Q=b.y*b.y*b.y,Z=g.x*g.x,$=g.x*g.x*g.x,H=g.y*g.y,V=v.x*v.x,G=v.x*v.x*v.x,J=v.y*v.y,K=m.x*m.x,W=m.x*m.x*m.x,tt=m.y*m.y,yt=m.y*m.y*m.y,et=new k(-_*yt+q*W-3*l.x*F*K*m.y+3*X*l.y*m.x*tt,-6*l.x*v.x*F*m.x*m.y+6*X*l.y*v.y*m.x*m.y+3*v.x*q*K-3*_*v.y*tt-3*l.x*F*v.y*K+3*X*v.x*l.y*tt,-6*g.x*l.x*F*m.x*m.y-6*l.x*v.x*F*v.y*m.x+6*X*v.x*l.y*v.y*m.y+3*g.x*q*K+3*V*q*m.x+3*g.x*X*l.y*tt-3*l.x*g.y*F*K-3*l.x*V*F*m.y+X*l.y*m.x*(6*g.y*m.y+3*J)+_*(-g.y*tt-2*J*m.y-m.y*(2*g.y*m.y+J)),w.x*f.y*l.x*l.y*m.x*m.y-w.y*f.x*l.x*l.y*m.x*m.y+6*g.x*v.x*q*m.x+3*w.x*f.x*l.x*l.y*tt+6*d.x*l.x*F*m.x*m.y-3*w.x*f.x*F*m.x*m.y-3*w.y*f.y*l.x*l.y*K-6*d.y*X*l.y*m.x*m.y-6*b.x*l.x*F*m.x*m.y+3*w.y*f.y*X*m.x*m.y-2*f.x*D*l.x*m.x*m.y-6*g.x*l.x*v.x*F*m.y-6*g.x*l.x*F*v.y*m.x-6*l.x*g.y*v.x*F*m.x+6*g.x*X*l.y*v.y*m.y+2*T*f.y*l.y*m.x*m.y+G*q-3*d.x*q*K+3*d.y*_*tt+3*b.x*q*K+B*l.x*K-S*l.y*tt-3*d.x*X*l.y*tt+3*d.y*l.x*F*K-2*w.x*f.y*X*tt+w.x*f.y*F*K-w.y*f.x*X*tt+2*w.y*f.x*F*K+3*b.x*X*l.y*tt-f.x*D*l.y*K-3*b.y*l.x*F*K+T*f.y*l.x*tt-3*l.x*V*F*v.y+X*l.y*m.x*(6*b.y*m.y+6*g.y*v.y)+X*v.x*l.y*(6*g.y*m.y+3*J)+_*(-2*g.y*v.y*m.y-b.y*tt-v.y*(2*g.y*m.y+J)-m.y*(2*b.y*m.y+2*g.y*v.y)),6*w.x*f.x*l.x*l.y*v.y*m.y+w.x*f.y*l.x*v.x*l.y*m.y+w.x*f.y*l.x*l.y*v.y*m.x-w.y*f.x*l.x*v.x*l.y*m.y-w.y*f.x*l.x*l.y*v.y*m.x-6*w.y*f.y*l.x*v.x*l.y*m.x-6*d.x*v.x*q*m.x+6*b.x*v.x*q*m.x+6*d.y*_*v.y*m.y+2*B*l.x*v.x*m.x-2*S*l.y*v.y*m.y+6*d.x*l.x*v.x*F*m.y+6*d.x*l.x*F*v.y*m.x+6*d.y*l.x*v.x*F*m.x-3*w.x*f.x*v.x*F*m.y-3*w.x*f.x*F*v.y*m.x+2*w.x*f.y*v.x*F*m.x+4*w.y*f.x*v.x*F*m.x-6*d.x*X*l.y*v.y*m.y-6*d.y*X*v.x*l.y*m.y-6*d.y*X*l.y*v.y*m.x-4*w.x*f.y*X*v.y*m.y-6*b.x*l.x*v.x*F*m.y-6*b.x*l.x*F*v.y*m.x-2*w.y*f.x*X*v.y*m.y+3*w.y*f.y*X*v.x*m.y+3*w.y*f.y*X*v.y*m.x-2*f.x*D*l.x*v.x*m.y-2*f.x*D*l.x*v.y*m.x-2*f.x*D*v.x*l.y*m.x-6*b.y*l.x*v.x*F*m.x-6*g.x*l.x*g.y*F*m.x-6*g.x*l.x*v.x*F*v.y+6*b.x*X*l.y*v.y*m.y+2*T*f.y*l.x*v.y*m.y+2*T*f.y*v.x*l.y*m.y+2*T*f.y*l.y*v.y*m.x+3*g.x*V*q+3*Z*q*m.x-3*l.x*g.y*V*F-3*Z*l.x*F*m.y+X*v.x*l.y*(6*b.y*m.y+6*g.y*v.y)+X*l.y*m.x*(6*b.y*v.y+3*H)+g.x*X*l.y*(6*g.y*m.y+3*J)+_*(-2*b.y*v.y*m.y-m.y*(2*b.y*v.y+H)-g.y*(2*g.y*m.y+J)-v.y*(2*b.y*m.y+2*g.y*v.y)),w.x*g.x*f.y*l.x*l.y*m.y+w.x*f.y*l.x*g.y*l.y*m.x+w.x*f.y*l.x*v.x*l.y*v.y-w.y*f.x*g.x*l.x*l.y*m.y-w.y*f.x*l.x*g.y*l.y*m.x-w.y*f.x*l.x*v.x*l.y*v.y-6*w.y*g.x*f.y*l.x*l.y*m.x-6*d.x*g.x*q*m.x+6*b.x*g.x*q*m.x+2*g.x*B*l.x*m.x+6*d.x*g.x*l.x*F*m.y+6*d.x*l.x*g.y*F*m.x+6*d.x*l.x*v.x*F*v.y+6*d.y*g.x*l.x*F*m.x-3*w.x*f.x*g.x*F*m.y-3*w.x*f.x*g.y*F*m.x-3*w.x*f.x*v.x*F*v.y+2*w.x*g.x*f.y*F*m.x+4*w.y*f.x*g.x*F*m.x-6*d.y*g.x*X*l.y*m.y-6*d.y*X*g.y*l.y*m.x-6*d.y*X*v.x*l.y*v.y-6*b.x*g.x*l.x*F*m.y-6*b.x*l.x*g.y*F*m.x-6*b.x*l.x*v.x*F*v.y+3*w.y*g.x*f.y*X*m.y-3*w.y*f.y*l.x*V*l.y+3*w.y*f.y*X*g.y*m.x+3*w.y*f.y*X*v.x*v.y-2*f.x*g.x*D*l.x*m.y-2*f.x*g.x*D*l.y*m.x-2*f.x*D*l.x*g.y*m.x-2*f.x*D*l.x*v.x*v.y-6*b.y*g.x*l.x*F*m.x-6*g.x*l.x*g.y*v.x*F+6*b.y*X*g.y*l.y*m.x+2*T*g.x*f.y*l.y*m.y+2*T*f.y*g.y*l.y*m.x+2*T*f.y*v.x*l.y*v.y-3*d.x*V*q+3*b.x*V*q+3*Z*v.x*q+B*l.x*V+3*d.y*l.x*V*F+w.x*f.y*V*F+2*w.y*f.x*V*F-f.x*D*V*l.y-3*b.y*l.x*V*F-3*Z*l.x*F*v.y+T*f.y*l.x*(2*g.y*m.y+J)+w.x*f.x*l.x*l.y*(6*g.y*m.y+3*J)+g.x*X*l.y*(6*b.y*m.y+6*g.y*v.y)+S*l.y*(-2*g.y*m.y-J)+d.y*_*(6*g.y*m.y+3*J)+w.y*f.x*X*(-2*g.y*m.y-J)+w.x*f.y*X*(-4*g.y*m.y-2*J)+d.x*X*l.y*(-6*g.y*m.y-3*J)+X*v.x*l.y*(6*b.y*v.y+3*H)+b.x*X*l.y*(6*g.y*m.y+3*J)+_*(-2*b.y*g.y*m.y-v.y*(2*b.y*v.y+H)-b.y*(2*g.y*m.y+J)-g.y*(2*b.y*m.y+2*g.y*v.y)),-d.x*w.x*f.y*l.x*l.y*m.y+d.x*w.y*f.x*l.x*l.y*m.y+6*d.x*w.y*f.y*l.x*l.y*m.x-6*d.y*w.x*f.x*l.x*l.y*m.y-d.y*w.x*f.y*l.x*l.y*m.x+d.y*w.y*f.x*l.x*l.y*m.x+w.x*w.y*f.x*f.y*l.x*m.y-w.x*w.y*f.x*f.y*l.y*m.x+w.x*b.x*f.y*l.x*l.y*m.y+w.x*b.y*f.y*l.x*l.y*m.x+w.x*g.x*f.y*l.x*l.y*v.y+w.x*f.y*l.x*g.y*v.x*l.y-b.x*w.y*f.x*l.x*l.y*m.y-6*b.x*w.y*f.y*l.x*l.y*m.x-w.y*f.x*b.y*l.x*l.y*m.x-w.y*f.x*g.x*l.x*l.y*v.y-w.y*f.x*l.x*g.y*v.x*l.y-6*w.y*g.x*f.y*l.x*v.x*l.y-6*d.x*b.x*q*m.x-6*d.x*g.x*v.x*q-2*d.x*B*l.x*m.x+6*b.x*g.x*v.x*q+2*b.x*B*l.x*m.x+2*g.x*B*l.x*v.x+2*d.y*S*l.y*m.y-6*d.x*d.y*l.x*F*m.x+3*d.x*w.x*f.x*F*m.y-2*d.x*w.x*f.y*F*m.x-4*d.x*w.y*f.x*F*m.x+3*d.y*w.x*f.x*F*m.x+6*d.x*d.y*X*l.y*m.y+6*d.x*b.x*l.x*F*m.y-3*d.x*w.y*f.y*X*m.y+2*d.x*f.x*D*l.x*m.y+2*d.x*f.x*D*l.y*m.x+6*d.x*b.y*l.x*F*m.x+6*d.x*g.x*l.x*F*v.y+6*d.x*l.x*g.y*v.x*F+4*d.y*w.x*f.y*X*m.y+6*d.y*b.x*l.x*F*m.x+2*d.y*w.y*f.x*X*m.y-3*d.y*w.y*f.y*X*m.x+2*d.y*f.x*D*l.x*m.x+6*d.y*g.x*l.x*v.x*F-3*w.x*b.x*f.x*F*m.y+2*w.x*b.x*f.y*F*m.x+w.x*w.y*D*l.x*m.x-3*w.x*f.x*b.y*F*m.x-3*w.x*f.x*g.x*F*v.y-3*w.x*f.x*g.y*v.x*F+2*w.x*g.x*f.y*v.x*F+4*b.x*w.y*f.x*F*m.x+4*w.y*f.x*g.x*v.x*F-2*d.x*T*f.y*l.y*m.y-6*d.y*b.x*X*l.y*m.y-6*d.y*b.y*X*l.y*m.x-6*d.y*g.x*X*l.y*v.y-2*d.y*T*f.y*l.x*m.y-2*d.y*T*f.y*l.y*m.x-6*d.y*X*g.y*v.x*l.y-w.x*w.y*T*l.y*m.y-2*w.x*C*l.x*l.y*m.x+3*b.x*w.y*f.y*X*m.y-2*b.x*f.x*D*l.x*m.y-2*b.x*f.x*D*l.y*m.x-6*b.x*b.y*l.x*F*m.x-6*b.x*g.x*l.x*F*v.y-6*b.x*l.x*g.y*v.x*F+3*w.y*b.y*f.y*X*m.x+3*w.y*g.x*f.y*X*v.y+3*w.y*f.y*X*g.y*v.x-2*f.x*b.y*D*l.x*m.x-2*f.x*g.x*D*l.x*v.y-2*f.x*g.x*D*v.x*l.y-2*f.x*D*l.x*g.y*v.x-6*b.y*g.x*l.x*v.x*F-C*f.x*f.y*l.x*m.x+2*b.x*T*f.y*l.y*m.y+6*b.y*X*g.y*v.x*l.y+2*I*w.y*l.x*l.y*m.y+I*f.x*f.y*l.y*m.y+2*T*b.y*f.y*l.y*m.x+2*T*g.x*f.y*l.y*v.y+2*T*f.y*g.y*v.x*l.y+$*q+3*M*q*m.x-3*L*_*m.y+3*Y*q*m.x+A*X*m.x-N*F*m.y-w.x*C*X*m.y+I*w.y*F*m.x-3*M*l.x*F*m.y+3*L*X*l.y*m.x-I*D*l.x*m.y+C*T*l.y*m.x-3*Z*l.x*g.y*F-3*Y*l.x*F*m.y+3*j*X*l.y*m.x+w.x*f.x*l.x*l.y*(6*b.y*m.y+6*g.y*v.y)+S*l.y*(-2*b.y*m.y-2*g.y*v.y)+d.y*_*(6*b.y*m.y+6*g.y*v.y)+w.y*f.x*X*(-2*b.y*m.y-2*g.y*v.y)+T*f.y*l.x*(2*b.y*m.y+2*g.y*v.y)+w.x*f.y*X*(-4*b.y*m.y-4*g.y*v.y)+d.x*X*l.y*(-6*b.y*m.y-6*g.y*v.y)+b.x*X*l.y*(6*b.y*m.y+6*g.y*v.y)+g.x*X*l.y*(6*b.y*v.y+3*H)+_*(-2*b.y*g.y*v.y-j*m.y-g.y*(2*b.y*v.y+H)-b.y*(2*b.y*m.y+2*g.y*v.y)),-d.x*w.x*f.y*l.x*l.y*v.y+d.x*w.y*f.x*l.x*l.y*v.y+6*d.x*w.y*f.y*l.x*v.x*l.y-6*d.y*w.x*f.x*l.x*l.y*v.y-d.y*w.x*f.y*l.x*v.x*l.y+d.y*w.y*f.x*l.x*v.x*l.y+w.x*w.y*f.x*f.y*l.x*v.y-w.x*w.y*f.x*f.y*v.x*l.y+w.x*b.x*f.y*l.x*l.y*v.y+w.x*b.y*f.y*l.x*v.x*l.y+w.x*g.x*f.y*l.x*g.y*l.y-b.x*w.y*f.x*l.x*l.y*v.y-6*b.x*w.y*f.y*l.x*v.x*l.y-w.y*f.x*b.y*l.x*v.x*l.y-w.y*f.x*g.x*l.x*g.y*l.y-6*d.x*b.x*v.x*q-2*d.x*B*l.x*v.x+2*b.x*B*l.x*v.x+2*d.y*S*l.y*v.y-6*d.x*d.y*l.x*v.x*F+3*d.x*w.x*f.x*F*v.y-2*d.x*w.x*f.y*v.x*F-4*d.x*w.y*f.x*v.x*F+3*d.y*w.x*f.x*v.x*F+6*d.x*d.y*X*l.y*v.y+6*d.x*b.x*l.x*F*v.y-3*d.x*w.y*f.y*X*v.y+2*d.x*f.x*D*l.x*v.y+2*d.x*f.x*D*v.x*l.y+6*d.x*b.y*l.x*v.x*F+6*d.x*g.x*l.x*g.y*F+4*d.y*w.x*f.y*X*v.y+6*d.y*b.x*l.x*v.x*F+2*d.y*w.y*f.x*X*v.y-3*d.y*w.y*f.y*X*v.x+2*d.y*f.x*D*l.x*v.x-3*w.x*b.x*f.x*F*v.y+2*w.x*b.x*f.y*v.x*F+w.x*w.y*D*l.x*v.x-3*w.x*f.x*b.y*v.x*F-3*w.x*f.x*g.x*g.y*F+4*b.x*w.y*f.x*v.x*F-2*d.x*T*f.y*l.y*v.y-6*d.y*b.x*X*l.y*v.y-6*d.y*b.y*X*v.x*l.y-6*d.y*g.x*X*g.y*l.y-2*d.y*T*f.y*l.x*v.y-2*d.y*T*f.y*v.x*l.y-w.x*w.y*T*l.y*v.y-2*w.x*C*l.x*v.x*l.y+3*b.x*w.y*f.y*X*v.y-2*b.x*f.x*D*l.x*v.y-2*b.x*f.x*D*v.x*l.y-6*b.x*b.y*l.x*v.x*F-6*b.x*g.x*l.x*g.y*F+3*w.y*b.y*f.y*X*v.x+3*w.y*g.x*f.y*X*g.y-2*f.x*b.y*D*l.x*v.x-2*f.x*g.x*D*l.x*g.y-C*f.x*f.y*l.x*v.x+2*b.x*T*f.y*l.y*v.y-3*w.y*Z*f.y*l.x*l.y+6*b.y*g.x*X*g.y*l.y+2*I*w.y*l.x*l.y*v.y+I*f.x*f.y*l.y*v.y+2*T*b.y*f.y*v.x*l.y+2*T*g.x*f.y*g.y*l.y-3*d.x*Z*q+3*b.x*Z*q+3*M*v.x*q-3*L*_*v.y+3*Y*v.x*q+Z*B*l.x+A*X*v.x-N*F*v.y+3*d.y*Z*l.x*F-w.x*C*X*v.y+w.x*Z*f.y*F+2*w.y*f.x*Z*F+I*w.y*v.x*F-f.x*Z*D*l.y-3*b.y*Z*l.x*F-3*M*l.x*F*v.y+3*L*X*v.x*l.y-I*D*l.x*v.y+C*T*v.x*l.y-3*Y*l.x*F*v.y+3*j*X*v.x*l.y+T*f.y*l.x*(2*b.y*v.y+H)+w.x*f.x*l.x*l.y*(6*b.y*v.y+3*H)+S*l.y*(-2*b.y*v.y-H)+d.y*_*(6*b.y*v.y+3*H)+w.y*f.x*X*(-2*b.y*v.y-H)+w.x*f.y*X*(-4*b.y*v.y-2*H)+d.x*X*l.y*(-6*b.y*v.y-3*H)+b.x*X*l.y*(6*b.y*v.y+3*H)+_*(-2*b.y*H-j*v.y-b.y*(2*b.y*v.y+H)),-d.x*w.x*f.y*l.x*g.y*l.y+d.x*w.y*f.x*l.x*g.y*l.y+6*d.x*w.y*g.x*f.y*l.x*l.y-6*d.y*w.x*f.x*l.x*g.y*l.y-d.y*w.x*g.x*f.y*l.x*l.y+d.y*w.y*f.x*g.x*l.x*l.y-w.x*w.y*f.x*g.x*f.y*l.y+w.x*w.y*f.x*f.y*l.x*g.y+w.x*b.x*f.y*l.x*g.y*l.y+6*w.x*f.x*b.y*l.x*g.y*l.y+w.x*b.y*g.x*f.y*l.x*l.y-b.x*w.y*f.x*l.x*g.y*l.y-6*b.x*w.y*g.x*f.y*l.x*l.y-w.y*f.x*b.y*g.x*l.x*l.y-6*d.x*b.x*g.x*q-2*d.x*g.x*B*l.x+6*d.y*b.y*_*g.y+2*b.x*g.x*B*l.x+2*d.y*S*g.y*l.y-2*S*b.y*g.y*l.y-6*d.x*d.y*g.x*l.x*F+3*d.x*w.x*f.x*g.y*F-2*d.x*w.x*g.x*f.y*F-4*d.x*w.y*f.x*g.x*F+3*d.y*w.x*f.x*g.x*F+6*d.x*d.y*X*g.y*l.y+6*d.x*b.x*l.x*g.y*F-3*d.x*w.y*f.y*X*g.y+2*d.x*f.x*g.x*D*l.y+2*d.x*f.x*D*l.x*g.y+6*d.x*b.y*g.x*l.x*F+4*d.y*w.x*f.y*X*g.y+6*d.y*b.x*g.x*l.x*F+2*d.y*w.y*f.x*X*g.y-3*d.y*w.y*g.x*f.y*X+2*d.y*f.x*g.x*D*l.x-3*w.x*b.x*f.x*g.y*F+2*w.x*b.x*g.x*f.y*F+w.x*w.y*g.x*D*l.x-3*w.x*f.x*b.y*g.x*F+4*b.x*w.y*f.x*g.x*F-6*d.x*b.y*X*g.y*l.y-2*d.x*T*f.y*g.y*l.y-6*d.y*b.x*X*g.y*l.y-6*d.y*b.y*g.x*X*l.y-2*d.y*T*g.x*f.y*l.y-2*d.y*T*f.y*l.x*g.y-w.x*w.y*T*g.y*l.y-4*w.x*b.y*f.y*X*g.y-2*w.x*C*g.x*l.x*l.y+3*b.x*w.y*f.y*X*g.y-2*b.x*f.x*g.x*D*l.y-2*b.x*f.x*D*l.x*g.y-6*b.x*b.y*g.x*l.x*F-2*w.y*f.x*b.y*X*g.y+3*w.y*b.y*g.x*f.y*X-2*f.x*b.y*g.x*D*l.x-C*f.x*g.x*f.y*l.x+6*b.x*b.y*X*g.y*l.y+2*b.x*T*f.y*g.y*l.y+2*I*w.y*l.x*g.y*l.y+I*f.x*f.y*g.y*l.y+2*T*b.y*g.x*f.y*l.y+2*T*b.y*f.y*l.x*g.y+3*M*g.x*q-3*L*_*g.y+3*Y*g.x*q+A*g.x*X-N*g.y*F-3*j*_*g.y-w.x*C*X*g.y+I*w.y*g.x*F-3*M*l.x*g.y*F+3*L*g.x*X*l.y-I*D*l.x*g.y+C*T*g.x*l.y-3*Y*l.x*g.y*F+3*j*g.x*X*l.y,d.x*d.y*w.x*f.y*l.x*l.y-d.x*d.y*w.y*f.x*l.x*l.y+d.x*w.x*w.y*f.x*f.y*l.y-d.y*w.x*w.y*f.x*f.y*l.x-d.x*w.x*b.y*f.y*l.x*l.y+6*d.x*b.x*w.y*f.y*l.x*l.y+d.x*w.y*f.x*b.y*l.x*l.y-d.y*w.x*b.x*f.y*l.x*l.y-6*d.y*w.x*f.x*b.y*l.x*l.y+d.y*b.x*w.y*f.x*l.x*l.y-w.x*b.x*w.y*f.x*f.y*l.y+w.x*w.y*f.x*b.y*f.y*l.x+w.x*b.x*b.y*f.y*l.x*l.y-b.x*w.y*f.x*b.y*l.x*l.y-2*d.x*b.x*B*l.x+2*d.y*S*b.y*l.y-3*d.x*d.y*w.x*f.x*F-6*d.x*d.y*b.x*l.x*F+3*d.x*d.y*w.y*f.y*X-2*d.x*d.y*f.x*D*l.x-2*d.x*w.x*b.x*f.y*F-d.x*w.x*w.y*D*l.x+3*d.x*w.x*f.x*b.y*F-4*d.x*b.x*w.y*f.x*F+3*d.y*w.x*b.x*f.x*F+6*d.x*d.y*b.y*X*l.y+2*d.x*d.y*T*f.y*l.y+2*d.x*w.x*C*l.x*l.y+2*d.x*b.x*f.x*D*l.y+6*d.x*b.x*b.y*l.x*F-3*d.x*w.y*b.y*f.y*X+2*d.x*f.x*b.y*D*l.x+d.x*C*f.x*f.y*l.x+d.y*w.x*w.y*T*l.y+4*d.y*w.x*b.y*f.y*X-3*d.y*b.x*w.y*f.y*X+2*d.y*b.x*f.x*D*l.x+2*d.y*w.y*f.x*b.y*X+w.x*b.x*w.y*D*l.x-3*w.x*b.x*f.x*b.y*F-2*d.x*T*b.y*f.y*l.y-6*d.y*b.x*b.y*X*l.y-2*d.y*b.x*T*f.y*l.y-2*d.y*I*w.y*l.x*l.y-d.y*I*f.x*f.y*l.y-2*d.y*T*b.y*f.y*l.x-2*w.x*b.x*C*l.x*l.y-w.x*w.y*T*b.y*l.y+3*b.x*w.y*b.y*f.y*X-2*b.x*f.x*b.y*D*l.x-b.x*C*f.x*f.y*l.x+3*L*w.x*f.x*l.x*l.y+3*w.x*f.x*j*l.x*l.y+2*b.x*T*b.y*f.y*l.y-3*M*w.y*f.y*l.x*l.y+2*I*w.y*b.y*l.x*l.y+I*f.x*b.y*f.y*l.y-3*Y*w.y*f.y*l.x*l.y-E*q+R*_+U*q-Q*_-3*d.x*Y*q-d.x*A*X+3*M*b.x*q+d.y*N*F+3*d.y*j*_+b.x*A*X+M*B*l.x-3*L*b.y*_-L*S*l.y+Y*B*l.x-N*b.y*F-S*j*l.y-d.x*I*w.y*F+d.y*w.x*C*X-3*d.x*L*X*l.y-d.x*C*T*l.y+d.y*I*D*l.x-w.x*C*b.y*X+3*M*d.y*l.x*F+M*w.x*f.y*F+2*M*w.y*f.x*F-2*L*w.x*f.y*X-L*w.y*f.x*X+I*b.x*w.y*F-3*d.x*j*X*l.y+3*d.y*Y*l.x*F+w.x*Y*f.y*F-2*w.x*j*f.y*X+b.x*C*T*l.y-w.y*f.x*j*X-M*f.x*D*l.y-3*M*b.y*l.x*F+3*L*b.x*X*l.y+L*T*f.y*l.x-I*b.y*D*l.x+2*Y*w.y*f.x*F+3*b.x*j*X*l.y-Y*f.x*D*l.y-3*Y*b.y*l.x*F+T*j*f.y*l.x).getRootsInInterval(0,1);O(et);for(var nt=0;nt<et.length;nt++){var xt=et[nt],rt=new k(l.x,f.x,w.x,d.x-b.x-xt*g.x-xt*xt*v.x-xt*xt*xt*m.x).getRoots(),it=new k(l.y,f.y,w.y,d.y-b.y-xt*g.y-xt*xt*v.y-xt*xt*xt*m.y).getRoots();if(rt.length>0&&it.length>0)t:for(var st=0;st<rt.length;st++){var ot=rt[st];if(0<=ot&&ot<=1)for(var at=0;at<it.length;at++)if(Math.abs(ot-it[at])<1e-4){var ht=m.multiply(xt*xt*xt).add(v.multiply(xt*xt).add(g.multiply(xt).add(b)));P.points.push(new s(ht.x,ht.y));break t}}}return P},intersectBezier3Ellipse:function(t,y,e,n,x,r,i){var a,h,p,u,c,l,f,w,d=new z;a=t.multiply(-1),h=y.multiply(3),p=e.multiply(-3),u=a.add(h.add(p.add(n))),c=new o(u.x,u.y),a=t.multiply(3),h=y.multiply(-6),p=e.multiply(3),u=a.add(h.add(p)),l=new o(u.x,u.y),a=t.multiply(-3),h=y.multiply(3),p=a.add(h),f=new o(p.x,p.y),w=new o(t.x,t.y);var m=r*r,v=i*i,g=new k(c.x*c.x*v+c.y*c.y*m,2*(c.x*l.x*v+c.y*l.y*m),2*(c.x*f.x*v+c.y*f.y*m)+l.x*l.x*v+l.y*l.y*m,2*c.x*v*(w.x-x.x)+2*c.y*m*(w.y-x.y)+2*(l.x*f.x*v+l.y*f.y*m),2*l.x*v*(w.x-x.x)+2*l.y*m*(w.y-x.y)+f.x*f.x*v+f.y*f.y*m,2*f.x*v*(w.x-x.x)+2*f.y*m*(w.y-x.y),w.x*w.x*v-2*w.y*x.y*m-2*w.x*x.x*v+w.y*w.y*m+x.x*x.x*v+x.y*x.y*m-m*v).getRootsInInterval(0,1);O(g);for(var b=0;b<g.length;b++){var P=g[b],M=c.multiply(P*P*P).add(l.multiply(P*P).add(f.multiply(P).add(w)));d.points.push(new s(M.x,M.y))}return d},intersectBezier3Line:function(t,y,e,n,x,r){var i,s,a,h,p,u,c,l,f,w,d=x.min(r),m=x.max(r),v=new z;i=t.multiply(-1),s=y.multiply(3),a=e.multiply(-3),h=i.add(s.add(a.add(n))),p=new o(h.x,h.y),i=t.multiply(3),s=y.multiply(-6),a=e.multiply(3),h=i.add(s.add(a)),u=new o(h.x,h.y),i=t.multiply(-3),s=y.multiply(3),a=i.add(s),c=new o(a.x,a.y),l=new o(t.x,t.y),w=new o(x.y-r.y,r.x-x.x),f=x.x*r.y-r.x*x.y;for(var g=new k(w.dot(p),w.dot(u),w.dot(c),w.dot(l)+f).getRoots(),b=0;b<g.length;b++){var P=g[b];if(0<=P&&P<=1){var M=t.lerp(y,P),E=y.lerp(e,P),L=e.lerp(n,P),R=M.lerp(E,P),I=E.lerp(L,P),N=R.lerp(I,P);x.x==r.x?d.y<=N.y&&N.y<=m.y&&v.appendPoint(N):x.y==r.y?d.x<=N.x&&N.x<=m.x&&v.appendPoint(N):d.x<=N.x&&N.x<=m.x&&d.y<=N.y&&N.y<=m.y&&v.appendPoint(N)}}return v}},_=h.TYPE;function F(t,y){if(0!==t.length&&0!==y.length)for(var e,n=function(t,y){return t<y.x&&(t=y.x),t<y.y&&(t=y.y),t},x=t.reduce(n,0),r=100*(x=y.reduce(n,x))*1e-15*Math.SQRT2,i=0;i<t.length;){for(e=0;e<y.length;e++)if(t[i].distanceFrom(y[e])<=r){t.splice(i,1);break}e==y.length&&i++}}var q={intersectPathShape:function(t,y,e,n){for(var x,r,i=new z,s=t.params[0],o=0;o<s.length;o++)r=U(s[o],y,e,n),x&&(F(x.points,r.points),i.appendPoints(x.points)),x=r;return x&&i.appendPoints(x.points),i},intersectLinesShape:function(t,y,e,n,x){var r,i,s=h.TYPE,o=t.params[0],a=new h(s.LINE,[0,0]),p=new z,u=function(t,x){a.params[0]=o[t],a.params[1]=o[x],F((r=U(a,y,e,n)).points,[o[x]]),p.appendPoints(r.points)};for(i=0;i<o.length-1;i++)u(i,i+1);return(void 0!==x&&x||t.type===s.RECT||t.type===s.POLYGON)&&u(o.length-1,0),p},intersectArcShape:function(t,y,e,n){e=e||a.IDENTITY,n=n||a.IDENTITY;var x,r=t.params[0],i=t.params[1],p=t.params[2],u=t.params[3],c=t.params[4],l=t.params[5];return e.isIdentity()&&0===u?x=U(h.newEllipse(r,i,p),y,e,n):(e=e.multiply(a.IDENTITY.translate(r.x,r.y).rotate(u)),r=new s(0,0),u=0,x=U(h.newEllipse(r,i,p),y,e,n)),x=function(t,y,e,n,x,r,i,s){if(0===t.points.length)return t;if(s&&!s.isIdentity())var h=s.inverse();var p=[],u=new o(1,0),c=2*Math.PI,l=i<0,f=Math.abs(i)>Math.PI,w=(new a).scaleNonUniform(1,n/e).rotate(r),d=(new a).scaleNonUniform(1,n/e).rotate(r+i);r=(u.angleBetween(u.transform(w))+c)%c,i=u.transform(w).angleBetween(u.transform(d)),i=(f?c-Math.abs(i):Math.abs(i))*(l?-1:1);for(var m,v,g=(new a).rotate(x).multiply(w),b=0;b<t.points.length;b++)m=t.points[b],v=u.transform(g).angleBetween(o.fromPoints(y,h?m.transform(h):m)),i>=0?(v=(v+2*c)%c)<=i&&p.push(m):(v=(v-2*c)%c)>=i&&p.push(m);return t.points=p,t}(x,r,i,p,u,c,l,e)},intersectEllipseEllipse:function(t,y,e,n,x,r){var i,o,a,h,p,u,c,l,f,w,d,m,v,g,b,P,M=[e*e,0,y*y,-2*e*e*t.x,-2*y*y*t.y,e*e*t.x*t.x+y*y*t.y*t.y-y*y*e*e],E=[r*r,0,x*x,-2*r*r*n.x,-2*x*x*n.y,r*r*n.x*n.x+x*x*n.y*n.y-x*x*r*r],L=(a=(i=M)[0]*(o=E)[1]-o[0]*i[1],h=i[0]*o[2]-o[0]*i[2],p=i[0]*o[3]-o[0]*i[3],u=i[0]*o[4]-o[0]*i[4],c=i[0]*o[5]-o[0]*i[5],l=i[1]*o[2]-o[1]*i[2],f=i[1]*o[4]-o[1]*i[4],w=i[1]*o[5]-o[1]*i[5],d=i[2]*o[3]-o[2]*i[3],m=i[3]*o[4]-o[3]*i[4],v=i[3]*o[5]-o[3]*i[5],new k(a*l-h*h,a*(b=f-d)+p*l-2*h*u,a*(g=w+m)+p*b-u*u-2*h*c,a*v+p*g-2*u*c,p*v-c*c)),R=L.getRoots(),I=.001*(M[0]*M[0]+2*M[1]*M[1]+M[2]*M[2]),N=.001*(E[0]*E[0]+2*E[1]*E[1]+E[2]*E[2]),C=new z,A=function(t,y,e){return Math.max(y,Math.min(e,t))};for(P=0;P<R.length;P++)R[P]=A(R[P],t.y-e,t.y+e),R[P]=A(R[P],n.y-r,n.y+r);R.sort(function(t,y){return t-y});for(var T=[],S=0;S<R.length;S++){var D=new k(M[0],M[3]+R[S]*M[1],M[5]+R[S]*(M[4]+R[S]*M[2]));Math.abs(D.coefs[0])<10*1e-15*Math.abs(D.coefs[2])&&(D.coefs[0]=0);var B=D.getRoots();T.push(0);for(var O=0;O<B.length;O++){var X=(M[0]*B[O]+M[1]*R[S]+M[3])*B[O]+(M[2]*R[S]+M[4])*R[S]+M[5];Math.abs(X)<I&&(X=(E[0]*B[O]+E[1]*R[S]+E[3])*B[O]+(E[2]*R[S]+E[4])*R[S]+E[5],Math.abs(X)<N&&(C.appendPoint(new s(B[O],R[S])),T[S]+=1))}}if(C.points.length<=0)return C;var _=C.points;if(8==_.length)(_=_.splice(0,6)).splice(2,2);else if(7==_.length)(_=_.splice(0,6)).splice(2,2),_.splice(T.indexOf(1),1);else if(6==_.length)_.splice(2,2),T.indexOf(0)>-1?_[0].distanceFrom(_[1])<_[2].distanceFrom(_[3])?_.splice(0,1):_.splice(2,1):T[0]==T[3]&&_.splice(1,2);else if(4==_.length)(2==R.length||4==R.length&&(2==T[0]&&2==T[1]||2==T[2]&&2==T[3]))&&_.splice(2,2);else if((3==_.length||5==_.length)&&(P=T.indexOf(2))>-1){3==_.length&&(P%=2);var F,q,Y,U=P+(P%2?-1:2);F=_[P].distanceFrom(_[P+1]),q=_[P].distanceFrom(_[U]),Y=_[P+1].distanceFrom(_[U]),F<q&&F<Y?_.splice(P,1):_.splice(U,1)}var j=L.zeroErrorEstimate();for(j*=100*Math.SQRT2,P=0;P<_.length-1;)_[P].distanceFrom(_[P+1])<j?_.splice(P+1,1):P++;return C.points=_,C},intersectEllipseLine:function(t,y,e,n,x){var r,i=new o(n.x,n.y),s=o.fromPoints(n,x),a=new o(t.x,t.y),h=i.subtract(a),p=new o(s.x/(y*y),s.y/(e*e)),u=new o(h.x/(y*y),h.y/(e*e)),c=s.dot(p),l=s.dot(u),f=l*l-c*(t=h.dot(u)-1),w=10*Math.max(Math.abs(c),Math.abs(l),Math.abs(t))*1e-15;if(Math.abs(f)<w&&(f=0),f<0)r=new z("Outside");else if(f>0){var d=Math.sqrt(f),m=(-l-d)/c,v=(-l+d)/c;v=v>1?v-1e-15:v<0?v+1e-15:v,((m=m>1?m-1e-15:m<0?m+1e-15:m)<0||1<m)&&(v<0||1<v)?r=new z(m<0&&v<0||m>1&&v>1?"Outside":"Inside"):(r=new z,0<=m&&m<=1&&r.appendPoint(n.lerp(x,m)),0<=v&&v<=1&&r.appendPoint(n.lerp(x,v)))}else{var g=-l/c;0<=g&&g<=1?(r=new z).appendPoint(n.lerp(x,g)):r=new z("Outside")}return r},intersectLineLine:function(t,y,e,n){var x,r=(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x),i=(y.x-t.x)*(t.y-e.y)-(y.y-t.y)*(t.x-e.x),o=(n.y-e.y)*(y.x-t.x)-(n.x-e.x)*(y.y-t.y);if(0!==o){var a=r/o,h=i/o;0<=a&&a<=1&&0<=h&&h<=1?(x=new z).points.push(new s(t.x+a*(y.x-t.x),t.y+a*(y.y-t.y))):x=new z}else x=new z(0===r||0===i?"Coincident":"Parallel");return x},intersectRayRay:function(t,y,e,n){var x,r=(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x),i=(y.x-t.x)*(t.y-e.y)-(y.y-t.y)*(t.x-e.x),o=(n.y-e.y)*(y.x-t.x)-(n.x-e.x)*(y.y-t.y);if(0!==o){var a=r/o;(x=new z).points.push(new s(t.x+a*(y.x-t.x),t.y+a*(y.y-t.y)))}else x=new z(0===r||0===i?"Coincident":"Parallel");return x}},Y={};function U(t,y,e,n){var x,r,i=t,o=y;if(null!==i&&null!==o)if(r=Y[i.type])x=r(i,o,e,n);else if(r=Y[o.type])x=r(o,i,n,e);else{var h,p,u,c,l;i.type===_.CIRCLE?(p=[i.params[0],i.params[1],i.params[1]],c=_.ELLIPSE):(p=i.params.slice(),c=i.type),o.type===_.CIRCLE?(u=[o.params[0],o.params[1],o.params[1]],l=_.ELLIPSE):(u=o.params.slice(),l=o.type);var f,w,d,m,v=e instanceof a&&n instanceof a;if(v)if(c===_.ELLIPSE&&l===_.ELLIPSE){var g,b,P;m=p[0],w=p[1],d=p[2];var M=u[0],E=u[1],L=u[2];e=e.multiply(a.IDENTITY.translate(m.x,m.y).scaleNonUniform(w/1,d/1)),m=new s(0,0),w=d=1,n=n.multiply(a.IDENTITY.translate(M.x,M.y).scaleNonUniform(E,L)),M=new s(0,0),E=L=1,g=(P=e.inverse().multiply(n).getDecomposition()).rotation.inverse().multiply(P.translation.inverse()),E=(b=P.scale).a,L=b.d,m=m.transform(g),f=e.multiply(g.inverse()),p[0]=m,p[1]=w,p[2]=d,u[0]=M,u[1]=E,u[2]=L}else{var R,I=function(t,y,e){var n=function(t){y[t]=y[t].transform(e)};if(t===_.LINE)n(0),n(1);else if(t===_.BEZIER2)n(0),n(1),n(2);else{if(t!==_.BEZIER3)throw new Error("Unknown shape: "+t);n(0),n(1),n(2),n(3)}};if(l===_.ELLIPSE)R=u,u=p,p=R,R=l,l=c,c=R,R=n,n=e,e=R;c===_.ELLIPSE?(m=p[0],w=p[1],d=p[2],e=e.multiply(a.IDENTITY.translate(m.x,m.y).scaleNonUniform(w/1,d/1)),m=new s(0,0),w=d=1,I(l,u,b=e.inverse().multiply(n)),f=e,p[0]=m,p[1]=w,p[2]=d):(I(c,p,e),I(l,u,n),f=a.IDENTITY)}if(c<l?(r="intersect"+c+l,h=p.concat(u)):(r="intersect"+l+c,h=u.concat(p)),x=q[r].apply(null,h),v)for(var N=0;N<x.points.length;N++)x.points[N]=x.points[N].transform(f)}else x=new z;return x}for(var j in Y[_.PATH]=q.intersectPathShape,Y[_.POLYLINE]=q.intersectLinesShape,Y[_.POLYGON]=q.intersectLinesShape,Y[_.RECT]=q.intersectLinesShape,Y[_.ROUNDRECT]=q.intersectPathShape,Y[_.ARC]=q.intersectArcShape,X)X.hasOwnProperty(j)&&(q[j]=X[j]);const Q=h.newShape;t.intersect=U,t.shape=Q,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index-umd.min.js.map
